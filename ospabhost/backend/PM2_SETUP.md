# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PM2 –¥–ª—è Backend

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2 (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

```bash
# –ì–ª–æ–±–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2
npm install -g pm2

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏
pm2 -v
```

## üöÄ –ó–∞–ø—É—Å–∫ Backend –≤ 4 —ç–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö

### –®–∞–≥ 1: –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
cd /var/www/ospab-host/backend
# –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ:
cd backend

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
npm install

# –ö–æ–º–ø–∏–ª—è—Ü–∏—è TypeScript
npm run build
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –¥–ª—è –ª–æ–≥–æ–≤

```bash
mkdir -p logs
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ —Å –ø–æ–º–æ—â—å—é PM2

```bash
# –ó–∞–ø—É—Å–∫ 4 —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ ecosystem.config.js
pm2 start ecosystem.config.js --env production

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é (–±–µ–∑ –∫–æ–Ω—Ñ–∏–≥–∞):
pm2 start dist/src/index.js -i 4 --name ospab-backend
```

### –®–∞–≥ 4: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞

```bash
# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pm2 save

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
pm2 startup

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É, –∫–æ—Ç–æ—Ä—É—é –≤—ã–≤–µ–¥–µ—Ç pm2 startup
# –û–±—ã—á–Ω–æ —ç—Ç–æ —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
# sudo env PATH=$PATH:/usr/bin pm2 startup systemd -u root --hp /root
```

## üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞

```bash
# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pm2 list

# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ü–µ—Å—Å–µ
pm2 show ospab-backend

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
pm2 monit
```

### –õ–æ–≥–∏

```bash
# –í—Å–µ –ª–æ–≥–∏
pm2 logs

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
pm2 logs ospab-backend

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
pm2 logs ospab-backend --lines 100

# –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
pm2 flush
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–µ–∑ –¥–∞—É–Ω—Ç–∞–π–º–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
pm2 reload ospab-backend

# –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ (—Å –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∞—É–Ω—Ç–∞–π–º–æ–º)
pm2 restart ospab-backend

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
pm2 stop ospab-backend

# –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ PM2
pm2 delete ospab-backend
```

## üîß –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ (–¥–µ–ø–ª–æ–π)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ PM2

```bash
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
pm2 deploy ecosystem.config.js production
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

```bash
cd /var/www/ospab-host

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
git pull origin main

# –ü–µ—Ä–µ—Ö–æ–¥ –≤ backend
cd backend

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –°–±–æ—Ä–∫–∞
npm run build

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–µ–∑ –¥–∞—É–Ω—Ç–∞–π–º–∞
pm2 reload ospab-backend

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
pm2 save
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–º—è—Ç–∏ –∏ CPU

```bash
pm2 monit
```

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2 Plus (–±–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)
pm2 link <secret_key> <public_key>

# –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –≤–µ–±-–¥–∞—à–±–æ—Ä–¥
pm2 web
# –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:9615
```

## ‚öôÔ∏è –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- **–≠–∫–∑–µ–º–ø–ª—è—Ä—ã**: 4 –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–º —Ä–µ–∂–∏–º–µ
- **–ü–æ—Ä—Ç**: 5000 (–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –≤–Ω—É—Ç—Ä–∏ PM2)
- **–ê–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫**: –î–∞
- **–õ–∏–º–∏—Ç –ø–∞–º—è—Ç–∏**: 500 MB –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å
- **–õ–æ–≥–∏**: `./logs/pm2-error.log` –∏ `./logs/pm2-out.log`

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ PM2 –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
pm2 list

# –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å 4 —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ ospab-backend –≤ —Å—Ç–∞—Ç—É—Å–µ "online"
```

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### PM2 –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

```bash
# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
pm2 unstartup

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é
pm2 startup
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É, –∫–æ—Ç–æ—Ä—É—é –≤—ã–≤–µ–¥–µ—Ç

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
pm2 save
```

### –ü—Ä–æ—Ü–µ—Å—Å—ã –∫—Ä–∞—à–∞—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ—à–∏–±–æ–∫
pm2 logs ospab-backend --err

# –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç –ø–∞–º—è—Ç–∏ –≤ ecosystem.config.js
# max_memory_restart: '1G'

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
pm2 reload ecosystem.config.js
```

### –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU

```bash
# –£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤
# –í ecosystem.config.js:
instances: 2

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
pm2 reload ecosystem.config.js
```

## üìù –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –û–±–Ω–æ–≤–∏—Ç—å PM2 –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏
npm install -g pm2@latest
pm2 update

# –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ PM2
pm2 save --force

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
pm2 info ospab-backend

# –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
pm2 describe ospab-backend
```

## üéØ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (TL;DR)

```bash
# 1. –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É backend
cd backend

# 2. –°–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
npm run build

# 3. –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É –ª–æ–≥–æ–≤
mkdir -p logs

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å PM2
pm2 start ecosystem.config.js --env production

# 5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
pm2 save
pm2 startup

# 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
pm2 list
```

–ì–æ—Ç–æ–≤–æ! Backend –∑–∞–ø—É—â–µ–Ω –≤ 4 —ç–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö –∏ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞. üöÄ
